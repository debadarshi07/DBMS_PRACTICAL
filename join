-- 1. Loan numbers for loans taken in Mumbai
SELECT Loan.loan_no 
FROM Loan 
JOIN Branch ON Loan.branch_code = Branch.branch_code 
WHERE Branch.branch_city = 'MUMBAI';

-- 2. Types of accounts in Delhi
SELECT DISTINCT Account.type 
FROM Account 
JOIN Branch ON Account.branch_code = Branch.branch_code 
WHERE Branch.branch_city = 'DELHI';

-- 3. Customers with account balance > 100000
SELECT Customer.name, Customer.phone_no 
FROM Customer 
JOIN Depositor ON Customer.cust_no = Depositor.cust_no 
JOIN Account ON Depositor.account_no = Account.account_no 
WHERE Account.balance > 100000;

-- 4. Installment details for "RAJ ANAND SINGH"
SELECT Installment.inst_no, Installment.inst_amount 
FROM Installment 
JOIN Loan ON Installment.loan_no = Loan.loan_no 
JOIN Customer ON Loan.cust_no = Customer.cust_no 
WHERE Customer.name = 'RAJ ANAND SINGH';

-- 5. Customers without an account of type "SB"
SELECT DISTINCT Customer.name 
FROM Customer 
JOIN Depositor ON Customer.cust_no = Depositor.cust_no 
JOIN Account ON Depositor.account_no = Account.account_no 
WHERE Account.type <> 'SB';

-- 6. Customers who have paid installments of 50000
SELECT DISTINCT Customer.name 
FROM Customer 
JOIN Loan ON Customer.cust_no = Loan.cust_no 
JOIN Installment ON Loan.loan_no = Installment.loan_no 
WHERE Installment.inst_amount = 50000;

-- 7. Customers' phone numbers with account at branch "SALTLake"
SELECT Customer.phone_no 
FROM Customer 
JOIN Depositor ON Customer.cust_no = Depositor.cust_no 
JOIN Account ON Depositor.account_no = Account.account_no 
JOIN Branch ON Account.branch_code = Branch.branch_code 
WHERE Branch.branch_name = 'SALTLAKE';

-- 8. Branch name and city where "ABHIJIT MISHRA" has an account
SELECT Branch.branch_name, Branch.branch_city 
FROM Branch 
JOIN Account ON Branch.branch_code = Account.branch_code 
JOIN Depositor ON Account.account_no = Depositor.account_no 
JOIN Customer ON Depositor.cust_no = Customer.cust_no 
WHERE Customer.name = 'ABHIJIT MISHRA';

-- 9. Account types and balance of "SWAROOP RAY"
SELECT Account.type, Account.balance 
FROM Account 
JOIN Depositor ON Account.account_no = Depositor.account_no 
JOIN Customer ON Depositor.cust_no = Customer.cust_no 
WHERE Customer.name = 'SWAROOP RAY';

-- 10. Branch codes with balance greater than the average balance
WITH AvgBalance AS (
    SELECT AVG(balance) AS avg_bal FROM Account
)
SELECT Branch.branch_code 
FROM Branch 
JOIN Account ON Branch.branch_code = Account.branch_code 
GROUP BY Branch.branch_code 
HAVING SUM(Account.balance) > (SELECT avg_bal FROM AvgBalance);
